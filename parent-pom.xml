<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>com.ng.mulesoft</groupId>
		<artifactId>ng-mule-bom</artifactId>
		<version>1.0.2</version>
		<relativePath>bom.xml</relativePath>
	</parent>
	<groupId>com.ng.mulesoft</groupId>
	<artifactId>ng-mule-parent-pom</artifactId>
    <version>1.0.4</version>
    <packaging>pom</packaging>
	<name>my-parent-pom</name>
	<properties>
        <!-- the layers of API-led connectivity, used for assigning layer in Visualizer: must be assigned to api.layer property -->
        <rtf.domain.external>api-${deployment.env}-us.nationalgrid.com</rtf.domain.external>
		<rtf.domain.internal>api-${deployment.env}-int-us.nationalgrid.com</rtf.domain.internal>
		<api.visualizer.eapi>Experience</api.visualizer.eapi>
        <api.visualizer.papi>Process</api.visualizer.papi>
        <api.visualizer.sapi>System</api.visualizer.sapi>
        <api.visualizer.backend>Backend</api.visualizer.backend>
        <api.visualizer.none>None</api.visualizer.none>
		<api.layer.eapi>eapi</api.layer.eapi>
        <api.layer.papi>papi</api.layer.papi>
        <api.layer.sapi>sapi</api.layer.sapi>
        <api.layer.integration>int</api.layer.integration>
		 <!-- for automated deployments -->
        <deployment.env></deployment.env>
        <!-- devs: change to your own prefix: -->
		<deployment.prefix>${user.name}-</deployment.prefix>
        <deployment.suffix>-${deployment.env}</deployment.suffix>
        <deployment.name>${project.artifactId}${deployment.suffix}</deployment.name>
		<sonar.sources>src/main/mule</sonar.sources>
    </properties>

	<build>
		<resources>
			<resource>
				<directory>src/main/resources</directory>
				<filtering>true</filtering>
			</resource>
		</resources>
		<testResources>
			<testResource>
				<directory>src/test/resources</directory>
				<filtering>true</filtering>
			</testResource>
		</testResources>
		<pluginManagement>
			<plugins>
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-resources-plugin</artifactId>
					<configuration>
						<nonFilteredFileExtensions>
                            <nonFilteredFileExtension>jks</nonFilteredFileExtension>
                            <nonFilteredFileExtension>keys</nonFilteredFileExtension>
                            <nonFilteredFileExtension>ks</nonFilteredFileExtension>
							<nonFilteredFileExtension>p12</nonFilteredFileExtension>
							<nonFilteredFileExtension>pfx</nonFilteredFileExtension>
							<nonFilteredFileExtension>crt</nonFilteredFileExtension>
							<nonFilteredFileExtension>pem</nonFilteredFileExtension>
						</nonFilteredFileExtensions>
					</configuration>
				</plugin>
				<plugin>
					<groupId>org.mule.tools.maven</groupId>
					<artifactId>mule-maven-plugin</artifactId>
					<version>${mule.maven.plugin.version}</version>
					<extensions>true</extensions>
				</plugin>
				<plugin>
					<groupId>org.mule.tools.maven</groupId>
					<artifactId>mule-app-maven-plugin</artifactId>
					<version>${mule.tools.version}</version>
					<extensions>true</extensions>
				</plugin>
				<plugin>
					<groupId>com.mulesoft.munit.tools</groupId>
					<artifactId>munit-maven-plugin</artifactId>
					<executions>
						<execution>
							<id>test</id>
							<phase>test</phase>
							<goals>
								<goal>test</goal>
								<goal>coverage-report</goal>
							</goals>
						</execution>
					</executions>
					<configuration>
						<runtimeVersion>${app.runtime}</runtimeVersion>
						<runtimeProduct>MULE_EE</runtimeProduct>
						<coverage>
							<runCoverage>true</runCoverage>
							<formats>
								<format>console</format>
								<format>json</format>
								<format>html</format>
							</formats>
							<ignoreFiles>
								<ignoreFile>error.xml</ignoreFile>
								<ignoreFile>global.xml</ignoreFile>
								<ignoreFile>api.xml</ignoreFile>
								<ignoreFile>health.xml</ignoreFile>
								<ignoreFile>module-error-handler-plugin.xml</ignoreFile>
							</ignoreFiles>
						</coverage>
					</configuration>
				</plugin>
				<plugin>
					<groupId>org.jacoco</groupId>
					<artifactId>jacoco-maven-plugin</artifactId>
					<executions>
						<execution>
							<id>default-prepare-agent</id>
							<goals><goal>prepare-agent</goal></goals>
						</execution>
						<execution>
							<id>default-report</id>
							<phase>prepare-package</phase>
							<goals><goal>report</goal></goals>
						</execution>
					</executions>
				</plugin>
				<plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-toolchains-plugin</artifactId>
                    <executions>
                        <execution>
                            <goals>
                                <goal>toolchain</goal>
                            </goals>
                        </execution>
                    </executions>
                    <configuration>
                        <toolchains>
                            <jdk>
                                <version>${jdk.global.version}</version>
                            </jdk>
                        </toolchains>
                    </configuration>
                </plugin>
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-release-plugin</artifactId>
					<configuration>
						<checkModificationExcludes>
							<checkModificationExclude>pom.xml</checkModificationExclude>
						</checkModificationExcludes>
						<tagNameFormat>@{project.artifactId}-@{project.version}</tagNameFormat>
					</configuration>
            	</plugin>
				<plugin>
					<artifactId>maven-scm-plugin</artifactId>
					<configuration>
						<tag>${project.artifactId}-${project.version}</tag>
						<username>${scmuser}</username>
						<password>${scmpassword}</password>
					</configuration>
				</plugin>
			</plugins>
		</pluginManagement>
	</build>
	<profiles>
		<profile>
			<id>onprem</id>
			<build>
				<plugins>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-deploy-plugin</artifactId>
						<configuration>
							<skip>true</skip>
						</configuration>
					</plugin>
					<plugin>
						<groupId>org.mule.tools.maven</groupId>
						<artifactId>mule-maven-plugin</artifactId>
						<version>${mule.maven.plugin.version}</version>
						<extensions>true</extensions>
						<configuration>
							<armDeployment>
								<muleVersion>${app.runtime.semver}</muleVersion>
								<!-- <authToken>${ap.authToken}</authToken>
								<connectedAppClientId>${ap.connectedAppClientId}</connectedAppClientId>
								<connectedAppClientSecret>${ap.connectedAppClientSecret}</connectedAppClientSecret>
								<connectedAppGrantType>client_credentials</connectedAppGrantType> -->
								<!-- <server>${ap.mavenServer}</server> -->
								<username>${ap.username}</username>
								<password>${ap.password}</password>
								<businessGroupId>${ap.businessGroupId}</businessGroupId>
								<applicationName>${deployment.name}</applicationName>
								<target>${ap.target}</target>
								<targetType>${ap.targetType}</targetType>
								<environment>${ap.environment}</environment>
								<properties>
                                    <anypoint.platform.config.analytics.agent.enabled>true</anypoint.platform.config.analytics.agent.enabled>
									<anypoint.platform.visualizer.displayName>${project.artifactId}</anypoint.platform.visualizer.displayName>
                                    <!-- api.layer must be set in every concrete Mule app! -->
                                    <anypoint.platform.visualizer.layer>${api.visualizer.layer}</anypoint.platform.visualizer.layer>
                                    <env>${deployment.env}</env>
                                    <encrypt.key>${encrypt.key}</encrypt.key>
                                    <key>${key}</key>
                                    <anypoint.platform.client_id>${ap.client_id}</anypoint.platform.client_id>
                                    <anypoint.platform.client_secret>${ap.client_secret}</anypoint.platform.client_secret>
                                </properties>
							</armDeployment>
						</configuration>
						<executions>
							<execution>
								<id>deploy</id>
								<phase>deploy</phase>
								<goals>
									<goal>deploy</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
		<profile>
			<id>cloudhub</id>
			<build>
				<plugins>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-deploy-plugin</artifactId>
						<version>${mule.maven.plugin.version}</version>
						<configuration>
							<skip>true</skip>
						</configuration>
					</plugin>
					<plugin>
						<groupId>org.mule.tools.maven</groupId>
						<artifactId>mule-maven-plugin</artifactId>
						<extensions>true</extensions>
						<configuration>
							<cloudHubDeployment>
								<!-- <server>${ap.mavenServer}</server> -->
								<!-- <authToken>${ap.authToken}</authToken>
								<connectedAppClientId>${ap.connectedAppClientId}</connectedAppClientId>
								<connectedAppClientSecret>${ap.connectedAppClientSecret}</connectedAppClientSecret>
								<connectedAppGrantType>client_credentials</connectedAppGrantType> -->
								<username>${ap.username}</username>
								<password>${ap.password}</password>
                                <environment>${ap.environment}</environment>
                                <region>us-east-2</region>
                                <muleVersion>${app.runtime.semver}</muleVersion>
                                <workers>${ap.ch.NumOfWorkers}</workers>
                                <workerType>${ap.ch.workerType}</workerType>
                                <objectStoreV2>true</objectStoreV2>
                                <applicationName>${deployment.name}</applicationName>
								<!-- <businessGroup>${ap.businessGroup}</businessGroup> -->
								<businessGroupId>${ap.businessGroupId}</businessGroupId>
                                <deploymentTimeout>600000</deploymentTimeout>
                                <properties>
                                    <anypoint.platform.config.analytics.agent.enabled>true</anypoint.platform.config.analytics.agent.enabled>
									<anypoint.platform.visualizer.displayName>${project.artifactId}</anypoint.platform.visualizer.displayName>
                                    <!-- api.layer must be set in every concrete Mule app! -->
                                    <anypoint.platform.visualizer.layer>${api.visualizer.layer}</anypoint.platform.visualizer.layer>
                                    <env>${deployment.env}</env>
                                    <encrypt.key>${encrypt.key}</encrypt.key>
                                    <key>${key}</key>
                                    <anypoint.platform.client_id>${ap.client_id}</anypoint.platform.client_id>
                                    <anypoint.platform.client_secret>${ap.client_secret}</anypoint.platform.client_secret>
                                </properties>
							</cloudHubDeployment>
						</configuration>
						<executions>
							<execution>
								<id>deploy</id>
								<phase>deploy</phase>
								<goals>
									<goal>deploy</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
        <profile>
        <id>rtf</id>
			<build>
			<plugins>
            <plugin>
                <groupId>org.mule.tools.maven</groupId>
                <artifactId>mule-maven-plugin</artifactId>
				<version>${mule.maven.plugin.version}</version>
                <extensions>true</extensions>
                <configuration>
                    <runtimeFabricDeployment>
						<uri>https://anypoint.mulesoft.com</uri>
						<!-- <server>${ap.mavenServer}</server> -->
						<!-- <authToken>${ap.authToken}</authToken>
						<connectedAppClientId>${ap.connectedAppClientId}</connectedAppClientId>
						<connectedAppClientSecret>${ap.connectedAppClientSecret}</connectedAppClientSecret>
						<connectedAppGrantType>client_credentials</connectedAppGrantType> -->
						<muleVersion>${app.runtime.semver}</muleVersion>
						<username>${ap.username}</username>
						<password>${ap.password}</password>
						<applicationName>${deployment.name}</applicationName>
						<target>${runtime.fabric.name}</target>
						<environment>${ap.environment}</environment>
						<businessGroupId>${ap.businessGroupId}</businessGroupId>
						<!-- <businessGroup>${ap.businessGroup}</businessGroup> -->
						<provider>MC</provider>
						<properties>
										<anypoint.platform.config.analytics.agent.enabled>true</anypoint.platform.config.analytics.agent.enabled>
										<anypoint.platform.visualizer.displayName>${project.artifactId}</anypoint.platform.visualizer.displayName>
										<!-- api.layer must be set in every concrete Mule app! -->
										<anypoint.platform.visualizer.layer>${api.visualizer.layer}</anypoint.platform.visualizer.layer>
										<env>${deployment.env}</env>
										<encrypt.key>${encrypt.key}</encrypt.key>
                                        <key>${key}</key>
										<anypoint.platform.client_id>${ap.client_id}</anypoint.platform.client_id>
										<anypoint.platform.client_secret>${ap.client_secret}</anypoint.platform.client_secret>
						</properties>
						<deploymentSettings>
							<publicUrl>${rtf.domain}/${deployment.name}</publicUrl>
							<lastMileSecurity>${rtf.lastMile}</lastMileSecurity>
							<clusteringEnabled>${rtf.clustering}</clusteringEnabled>
							<replicationFactor>${rtf.replication.factor}</replicationFactor>
							<cpuReserved>${rtf.cpu.res}</cpuReserved>
							<memoryReserved>${rtf.mem.res}</memoryReserved>
							<cpuMax>${rtf.cpu.max}</cpuMax>
							<memoryMax>${rtf.mem.max}</memoryMax>
						</deploymentSettings>
                    </runtimeFabricDeployment>
                </configuration>
            </plugin>
			</plugins>
			</build>
        </profile>
	</profiles>
	<dependencies/>
</project>
